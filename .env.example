# =====================
# Hermes (HTTP sender)
# =====================

# -------- Core --------
HERMES_MANIFEST=/app/manifest.toml
SERVER_LISTEN_ADDRESS=0.0.0.0:4000
SSL_SERVER_CERTIFICATE=/app/etc/keys/tls/server.crt
SSL_SERVER_KEY=/app/etc/keys/tls/server.key

# -------- Auth/session (Damocles) --------
SESSION_STATE_API=https://damocles:3000/api/auth/session
SESSION_COOKIE_NAME=s
ADMIN_ROLE_NAME=admin
DEVELOPER_ROLE_NAME=developer
# AUTH_DEV_BYPASS=true  # optional dev bypass

# -------- Electrician sender (Hermes -> ForwardRelay) --------
ELECTRICIAN_TARGET=exodus:50053,exodus:50054

# TLS to receiving relays
ELECTRICIAN_TLS_ENABLE=true
ELECTRICIAN_TLS_CLIENT_CRT=/app/etc/keys/tls/client.crt
ELECTRICIAN_TLS_CLIENT_KEY=/app/etc/keys/tls/client.key
ELECTRICIAN_TLS_CA=/app/etc/keys/tls/ca.crt
ELECTRICIAN_TLS_INSECURE=true   # only affects OAuth HTTP client (dev)

# Compression & payload encryption
ELECTRICIAN_COMPRESS=snappy
ELECTRICIAN_ENCRYPT=aesgcm
ELECTRICIAN_AES256_KEY_HEX=ea8ccb51eefcdd058b0110c4adebaf351acbf43db2ad250fdc0d4131c959dfec

# Static headers on every publish (optional)
ELECTRICIAN_STATIC_HEADERS=x-tenant=local,x-env=dev

# -------- OAuth2 client-credentials (Hermes -> Relay) --------
OAUTH_ISSUER_BASE=https://damocles:3000
OAUTH_JWKS_URL=https://damocles:3000/api/auth/.well-known/jwks.json
OAUTH_CLIENT_ID=steeze-local-cli
OAUTH_CLIENT_SECRET=local-secret
OAUTH_SCOPES=write:data
OAUTH_REFRESH_LEEWAY=20s
# OAUTH_PREFLIGHT_TIMEOUT=8s  # optional preflight token check

# -------- Downstream auth used by manifest policies --------
ELECTRICIAN_STATIC_BEARER=Bearer dev-test-token

# -------- Logging --------
LOG_DIRECTORY=/app/log
LOG_FILE_NAME=http-access.log
LOG_FILE_MAX_SIZE_IN_MB=50
LOG_FILE_MAX_BACKUPS=3
LOG_FILE_MAX_AGE_IN_DAYS=28
DEFAULT_TIMEOUT_IN_SECONDS=30

# -------- Assertion verification (Damocles) --------
ASSERTION_KEY_URL=https://damocles:3000/api/auth/oauth/public-key.pem
ASSERTION_COOKIE_NAME=assert
ASSERTION_ISSUER=auth-service
ASSERTION_AUDIENCE=session-assertion
ASSERTION_LEEWAY_SECONDS=60
# ASSERTION_KEY_KID=    # optional kid if JWKS has multiple keys


# =====================
# Exodus (receiver + sinks)
# =====================

# -------- Core --------
EXODUS_MANIFEST=/app/manifest.toml
SERVER_LISTEN_ADDRESS=0.0.0.0:5001

# -------- Receiver TLS (gRPC) --------
ELECTRICIAN_RX_TLS_ENABLE=true
ELECTRICIAN_RX_TLS_SERVER_CRT=/app/etc/keys/tls/server.crt
ELECTRICIAN_RX_TLS_SERVER_KEY=/app/etc/keys/tls/server.key
ELECTRICIAN_RX_TLS_CA=/app/etc/keys/tls/ca.crt
ELECTRICIAN_RX_TLS_SERVER_NAME=localhost

# -------- Receiver auth (optional; either/both) --------
# OAUTH_JWKS_URL=https://damocles:3000/api/auth/.well-known/jwks.json
# OAUTH_INTROSPECT_URL=https://damocles:3000/api/auth/oauth/introspect
# OAUTH_INTROSPECT_AUTH=basic    # or "bearer"
# OAUTH_CLIENT_ID=...
# OAUTH_CLIENT_SECRET=...
# OAUTH_INTROSPECT_BEARER=...
# OAUTH_SCOPES=read:data
# OAUTH_REQUIRED_AUD=relay,exodus

# -------- Payload crypto --------
ELECTRICIAN_COMPRESS=snappy
ELECTRICIAN_ENCRYPT=aesgcm
ELECTRICIAN_AES256_KEY_HEX=ea8ccb51eefcdd058b0110c4adebaf351acbf43db2ad250fdc0d4131c959dfec

# -------- S3 (Parquet sink) --------
S3_REGION=us-east-1
S3_ENDPOINT=http://localstack:4566
AWS_ACCESS_KEY_ID=test
AWS_SECRET_ACCESS_KEY=test
AWS_ASSUME_ROLE_ARN=arn:aws:iam::000000000000:role/exodus-dev-role
AWS_SESSION_NAME=electrician-writer
AWS_SESSION_DURATION_MIN=15

S3_BUCKET=steeze-dev
S3_PREFIX_TEMPLATE=org={org}/feedback/demo/{yyyy}/{MM}/{dd}/{HH}/{mm}/
ORG_ID=4d948fa0-084e-490b-aad5-cfd01eeab79a
S3_SSE_MODE=aws:kms
S3_KMS_KEY_ARN=arn:aws:kms:us-east-1:000000000000:alias/electrician-dev

# S3 writer knobs
PARQUET_COMPRESSION=zstd
ROLL_WINDOW_MS=2000
ROLL_MAX_RECORDS=5
BATCH_MAX_RECORDS=5
BATCH_MAX_BYTES_MB=1
BATCH_MAX_AGE_MS=2000

# -------- Kafka (sink) --------
KAFKA_BROKERS=redpanda:9093
KAFKA_TOPIC=feedback-demo
KAFKA_FORMAT=ndjson
KAFKA_KEY_TEMPLATE={customerId}
KAFKA_HEADERS=source=exodus

# batching / writer
KAFKA_WRITER_BATCH_TIMEOUT_MS=400
KAFKA_BATCH_MAX_RECORDS=10000
KAFKA_BATCH_MAX_BYTES_MB=16
KAFKA_BATCH_MAX_AGE_MS=800

# security (TLS+mTLS+SASL)
KAFKA_CLIENT_ID=exodus-kafka-writer
KAFKA_TLS_ENABLE=true
KAFKA_TLS_CA_FILES=/app/etc/keys/tls/ca.crt
KAFKA_TLS_CLIENT_CERT=/app/etc/keys/tls/client.crt
KAFKA_TLS_CLIENT_KEY=/app/etc/keys/tls/client.key
KAFKA_TLS_SERVER_NAME=localhost
KAFKA_TLS_INSECURE=false
KAFKA_SASL_MECHANISM=SCRAM-SHA-256
KAFKA_SASL_USERNAME=app
KAFKA_SASL_PASSWORD=app-secret

# -------- Shared (Damocles session/assertion) --------
SESSION_STATE_API=https://damocles:3000/api/auth/session
SESSION_COOKIE_NAME=s
ADMIN_ROLE_NAME=admin
DEVELOPER_ROLE_NAME=developer
ASSERTION_KEY_URL=https://damocles:3000/api/auth/oauth/public-key.pem
ASSERTION_COOKIE_NAME=assert
ASSERTION_ISSUER=auth-service
ASSERTION_AUDIENCE=session-assertion
ASSERTION_LEEWAY_SECONDS=60
